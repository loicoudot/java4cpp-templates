<?xml version="1.0" encoding="UTF-8"?>
<templates xmlns="http://java4cpp.loicoudot.github.com"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://java4cpp.loicoudot.github.com https://raw.github.com/loicoudot/java4cpp-core/master/templates.xsd">
	<sourceTemplates>
		<sourceTemplate>enum-template.ftl</sourceTemplate>
		<sourceTemplate>header-template.ftl</sourceTemplate>
		<sourceTemplate>source-template.ftl</sourceTemplate>
	</sourceTemplates>
	<globalTemplates>
		<globalTemplate>include-template.ftl</globalTemplate>
		<globalTemplate>exception-template.ftl</globalTemplate>
	</globalTemplates>
	<datatypes>
		<fallback>
			<cppType>const ${cppFullName}&amp;</cppType>
			<cppReturnType>${cppFullName}</cppReturnType>
			<dependencies>${addDependency(javaName)}</dependencies>
			<functions>
				<function name="java2cpp">${class.cppFullName} ${arg1} = ${class.cppFullName}(${arg2});
				javaEnv->DeleteLocalRef(${arg2});
				</function>
				<function name="cpp2java">${class.jniSignature} ${arg1} = ${arg2}.getJavaObject();
				</function>
			</functions>
		</fallback>
		<array>
			<cppType>const std::vector&lt;${innerType.cppReturnType} &gt;&amp;</cppType>
			<cppReturnType>std::vector&lt;${innerType.cppReturnType} &gt;</cppReturnType>
			<dependencies>${addInclude("&lt;vector&gt;")}&lt;#assign current = innerType&gt;&lt;#list 1..20 as x&gt;&lt;#if current.isPrimitive&gt;&lt;#break/&gt;&lt;#elseif !current.isArray&gt;${addDependency(current)}&lt;/#if&gt;&lt;#if !current.innerType??&gt;&lt;#break/&gt;&lt;/#if&gt;&lt;#assign current = current.innerType&gt;&lt;/#list&gt;</dependencies>
			<functions>
				<function name="java2cpp">&lt;#if class.innerType.jniMethodName == "Object"&gt;
				std::vector&lt;${class.innerType.cppReturnType} &gt; ${arg1};
				jsize ${arg1}size = javaEnv->GetArrayLength((jobjectArray)${arg2});
				for(int i = 0; i &lt; ${arg1}size; ++i) {
				jobject ${arg1}elem = javaEnv->GetObjectArrayElement((jobjectArray)${arg2}, i);
				${class.innerType.functions.java2cpp("${arg1}tmp", "${arg1}elem")}
				${arg1}.push_back(${arg1}tmp);
				javaEnv->DeleteLocalRef(${arg1}elem);
				}
				javaEnv->DeleteLocalRef(${arg2});
				&lt;#else&gt;
				${class.innerType.cppReturnType}* ${arg1}values = (${class.innerType.cppReturnType}*)javaEnv->Get${class.innerType.jniMethodName}ArrayElements((${class.jniSignature})${arg2}, NULL);
				std::vector&lt;${class.innerType.cppReturnType} &gt; ${arg1}(${arg1}values, ${arg1}values+javaEnv->GetArrayLength((${class.jniSignature})${arg2}));
				javaEnv->Release${class.innerType.jniMethodName}ArrayElements((${class.jniSignature})${arg2}, (${class.innerType.jniSignature}*)${arg1}values, JNI_ABORT);
				javaEnv->DeleteLocalRef(${arg2});
				&lt;/#if&gt;
				</function>
				<function name="cpp2java">&lt;#if class.innerType.jniMethodName == "Object"&gt;
				jclass ${arg1}cls = Java4CppRuntime::getClass(javaEnv, "${class.innerType.javaName?replace('.', '/')}");
				jobjectArray ${arg1} = javaEnv->NewObjectArray((jsize)${arg2}.size(), ${arg1}cls, NULL);
				for(jsize ${arg1}idx = 0; ${arg1}idx &lt; (jsize)${arg2}.size(); ++${arg1}idx) {
					${class.innerType.functions.cpp2java("${arg1}elem", "${arg2}[${arg1}idx]")}
					javaEnv->SetObjectArrayElement(${arg1}, ${arg1}idx, ${arg1}elem);
					&lt;#if class.innerType.functions.cpp2javaClean??&gt;${class.innerType.functions.cpp2javaClean("${arg1}elem")}&lt;/#if&gt;
				}
				&lt;#elseif class.innerType.jniMethodName == "Boolean"&gt;
				${class.jniSignature} ${arg1} = javaEnv->New${class.innerType.jniMethodName}Array((jsize)${arg2}.size());
				for(jsize ${arg1}idx = 0; ${arg1}idx &lt; (jsize)${arg2}.size(); ++${arg1}idx) {
					${class.innerType.functions.cpp2java("${arg1}elem", "${arg2}[${arg1}idx]")}
					javaEnv->Set${class.innerType.jniMethodName}ArrayRegion(${arg1}, ${arg1}idx, 1, (${class.innerType.jniSignature}*)&amp;${arg1}elem);
					&lt;#if class.innerType.functions.cpp2javaClean??&gt;${class.innerType.functions.cpp2javaClean("${arg1}elem")};&lt;/#if&gt;
				}
				&lt;#else&gt;
				${class.jniSignature} ${arg1} = javaEnv->New${class.innerType.jniMethodName}Array((jsize)${arg2}.size());
				javaEnv->Set${class.innerType.jniMethodName}ArrayRegion(${arg1}, 0, (jsize)${arg2}.size(), (${class.innerType.jniSignature}*)&amp;${arg2}[0]);
				&lt;/#if&gt;
				</function>
				<function name="cpp2javaClean">javaEnv->DeleteLocalRef(${arg1});
				</function>
			</functions>
		</array>
		<enum>
			<cppType>${cppFullName}&lt;#if !isInnerClass&gt;Enum&lt;/#if&gt;::${cppShortName}Enum</cppType>
			<dependencies>${addDependency(javaName)}</dependencies>
			<functions>
				<function name="java2cpp">jclass enumcls = Java4CppRuntime::getClass(javaEnv, "${class.javaName?replace('.', '/')}");
				jmethodID ordinal = Java4CppRuntime::getMethodID(javaEnv, enumcls, "ordinal", "()I");
				${class.cppFullName}&lt;#if !class.isInnerClass&gt;Enum&lt;/#if&gt;::${class.cppShortName}Enum ${arg1} = (${class.cppFullName}&lt;#if !class.isInnerClass&gt;Enum&lt;/#if&gt;::${class.cppShortName}Enum)javaEnv->CallIntMethod(${arg2}, ordinal);
				</function>
				<function name="cpp2java">jclass ${arg1}cls = Java4CppRuntime::getClass(javaEnv, "${class.javaName?replace('.', '/')}");
				jmethodID ${arg1}values = Java4CppRuntime::getStaticMethodID(javaEnv, ${arg1}cls, "values", "()[${class.javaSignature}");
      			jobjectArray ${arg1}array = (jobjectArray)javaEnv->CallStaticObjectMethod(${arg1}cls, ${arg1}values);
      			jobject ${arg1} = javaEnv->GetObjectArrayElement(${arg1}array, (jsize)${arg2});
				</function>
				<function name="cpp2javaClean">javaEnv->DeleteLocalRef(${arg1});
				javaEnv->DeleteLocalRef(${arg1}array);
				</function>
			</functions>
		</enum>
		<templates>
			<template class="void">
				<cppType>void</cppType>
			</template>
			<template class="boolean">
				<cppType>bool</cppType>
				<functions>
					<function name="java2cpp">bool ${arg1} = ${arg2} == JNI_TRUE;</function>
					<function name="cpp2java">${class.jniSignature} ${arg1} = (${class.jniSignature})${arg2};</function>
				</functions>
			</template>
			<template class="byte">
				<cppType>signed char</cppType>
				<functions>
					<function name="java2cpp">signed char ${arg1} = (signed char)${arg2};</function>
					<function name="cpp2java">${class.jniSignature} ${arg1} = (${class.jniSignature})${arg2};</function>
				</functions>
			</template>
			<template class="char">
				<cppType>char</cppType>
				<functions>
					<function name="java2cpp">char ${arg1} = (char)${arg2};</function>
					<function name="cpp2java">${class.jniSignature} ${arg1} = (${class.jniSignature})${arg2};</function>
				</functions>
			</template>
			<template class="double">
				<cppType>double</cppType>
				<functions>
					<function name="java2cpp">double ${arg1} = (double)${arg2};</function>
					<function name="cpp2java">${class.jniSignature} ${arg1} = (${class.jniSignature})${arg2};</function>
				</functions>
			</template>
			<template class="float">
				<cppType>float</cppType>
				<functions>
					<function name="java2cpp">float ${arg1} = (float)${arg2};</function>
					<function name="cpp2java">${class.jniSignature} ${arg1} = (${class.jniSignature})${arg2};</function>
				</functions>
			</template>
			<template class="int">
				<cppType>int</cppType>
				<functions>
					<function name="java2cpp">int ${arg1} = (int)${arg2};</function>
					<function name="cpp2java">${class.jniSignature} ${arg1} = (${class.jniSignature})${arg2};</function>
				</functions>
			</template>
			<template class="long">
				<cppType>long long</cppType>
				<functions>
					<function name="java2cpp">long long ${arg1} = (long long)${arg2};</function>
					<function name="cpp2java">${class.jniSignature} ${arg1} = (${class.jniSignature})${arg2};</function>
				</functions>
			</template>
			<template class="short">
				<cppType>short</cppType>
				<functions>
					<function name="java2cpp">short ${arg1} = (short)${arg2};</function>
					<function name="cpp2java">${class.jniSignature} ${arg1} = (${class.jniSignature})${arg2};</function>
				</functions>
			</template>
		</templates>
	</datatypes>
	<copyFiles>
		<copyFile>java4cpp_runtime.h</copyFile>
		<copyFile>java4cpp_runtime.cpp</copyFile>
		<copyFile>java_exceptions.h</copyFile>
		<copyFile>jvm_launcher.h</copyFile>
		<copyFile>jvm_launcher.cpp</copyFile>
	</copyFiles>
</templates>